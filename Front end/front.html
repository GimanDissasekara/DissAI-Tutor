import React, { useState, useRef, useEffect } from 'react';
import { Send } from 'lucide-react';

// Mock expert system response function (replace with actual backend logic)
const getExpertResponse = async (userMessage) => {
  // Simulated expert system responses
  const responses = {
    'hello': "Hello! I'm an expert system ready to assist you.",
    'how are you': "I'm functioning perfectly. How can I help you today?",
    'what can you do': "I can provide expert advice on various topics. Please ask me a specific question.",
    'default': "I'm not sure I understand. Could you rephrase your question?"
  };

  // Simple matching logic (replace with more sophisticated NLP in real implementation)
  const matchedResponse = Object.keys(responses).find(key => 
    userMessage.toLowerCase().includes(key)
  );

  return responses[matchedResponse] || responses['default'];
};

const ExpertSystemChatbot = () => {
  const [messages, setMessages] = useState([
    { id: 0, text: "Welcome! I'm your expert system assistant. How can I help you today?", type: 'system' }
  ]);
  const [inputMessage, setInputMessage] = useState('');
  const messagesEndRef = useRef(null);

  // Scroll to bottom when messages update
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const handleSendMessage = async () => {
    if (!inputMessage.trim()) return;

    // Add user message
    const userMessage = { 
      id: messages.length, 
      text: inputMessage, 
      type: 'user' 
    };
    setMessages(prevMessages => [...prevMessages, userMessage]);

    // Clear input
    setInputMessage('');

    try {
      // Get expert system response
      const response = await getExpertResponse(inputMessage);
      
      // Add expert response
      setMessages(prevMessages => [...prevMessages, {
        id: prevMessages.length + 1,
        text: response,
        type: 'system'
      }]);
    } catch (error) {
      console.error('Error getting expert response:', error);
      setMessages(prevMessages => [...prevMessages, {
        id: prevMessages.length + 1,
        text: "Sorry, I encountered an error processing your request.",
        type: 'system'
      }]);
    }
  };

  return (
    <div className="flex flex-col h-screen max-w-xl mx-auto bg-gray-100">
      {/* Chat Header */}
      <div className="bg-blue-600 text-white p-4 text-center">
        <h1 className="text-xl font-bold">Expert System Assistant</h1>
      </div>

      {/* Messages Container */}
      <div className="flex-grow overflow-y-auto p-4 space-y-3">
        {messages.map((msg) => (
          <div
            key={msg.id}
            className={`p-3 rounded-lg max-w-[80%] ${
              msg.type === 'user' 
                ? 'bg-blue-500 text-white self-end ml-auto' 
                : 'bg-gray-200 text-black self-start mr-auto'
            }`}
          >
            {msg.text}
          </div>
        ))}
        <div ref={messagesEndRef} />
      </div>

      {/* Input Area */}
      <div className="bg-white p-4 flex items-center border-t">
        <input 
          type="text"
          value={inputMessage}
          onChange={(e) => setInputMessage(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
          placeholder="Ask your question..."
          className="flex-grow p-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button 
          onClick={handleSendMessage}
          className="bg-blue-600 text-white p-2 rounded-r-lg hover:bg-blue-700"
        >
          <Send size={24} />
        </button>
      </div>
    </div>
  );
};

export default ExpertSystemChatbot;